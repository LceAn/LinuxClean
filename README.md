# Linux 系统清理脚本说明文档

## 简介

该脚本旨在帮助用户清理 Linux 系统中的临时文件、缓存和旧内核，释放磁盘空间并优化系统性能。通过一步步的交互式提示，用户可以选择要执行的清理操作，从而安全、高效地维护系统。

---

## 特性

- **系统信息检测**：在脚本开始时，显示操作系统、登录用户名、CPU 数量、内存和硬盘使用情况等系统信息。
- **清理旧的内核包和残留的配置文件**：自动检测并移除不再使用的旧内核，释放大量磁盘空间。
- **清理 `/tmp` 目录下的临时文件**：删除系统中的临时文件，防止磁盘空间被无用文件占用。
- **清理 APT 缓存目录 `/var/cache/apt/archives`**：清理已下载的包文件，避免缓存占用过多空间。
- **清理用户缓存目录 `~/.cache`**：删除用户级别的缓存文件，优化个人应用程序的性能。
- **清理 systemd 日志 `/var/log/journal`**：管理系统日志大小，防止日志文件占用过多磁盘空间。
- **交互式操作**：在执行每个清理步骤前，都会提示用户确认，避免误操作。

---

## 使用方法

### 1. 下载脚本

将脚本代码复制到本地文件，例如 `linux_cleanup.sh`。

### 2. 赋予执行权限

在终端中，运行以下命令为脚本添加执行权限：

```bash
chmod +x linux_cleanup.sh
```

### 3. 运行脚本

由于脚本需要执行系统级的清理操作，必须以 `root` 身份或使用 `sudo` 运行：

```bash
sudo ./linux_cleanup.sh
```

或切换到 `root` 用户后运行：

```bash
su -
./linux_cleanup.sh
```

---

## 功能说明

### **步骤 1：显示系统信息**

脚本会首先检测并显示以下系统信息：

- **操作系统**：当前运行的 Linux 发行版名称。
- **登录用户名**：执行脚本的用户。
- **CPU 数量**：系统的 CPU 核心数。
- **内存大小和使用率**：总内存和已用内存，以及使用百分比。
- **硬盘大小和使用率**：根目录 `/` 的总容量和已用容量，以及使用百分比。

### **步骤 2：清理旧的内核包和残留的配置文件**

- **检测当前内核**：获取当前正在运行的内核版本，防止误删。
- **列出已安装的内核包**：显示系统中所有已安装的内核包。
- **筛选旧内核包**：将除当前内核之外的旧内核包列出。
- **用户确认**：提示用户是否确认移除旧内核包。
- **移除旧内核包**：如果用户确认，使用 `apt remove --purge` 命令移除旧内核包。
- **自动清理依赖项**：执行 `apt autoremove --purge`，移除不再需要的依赖包。
- **更新 GRUB 引导菜单**：确保引导菜单更新，反映当前的内核状态。
- **清理残留的配置文件**：删除已移除包的残留配置文件。

### **步骤 3：清理 `/tmp` 目录下的临时文件**

- **用户确认**：提示用户是否清理 `/tmp` 目录下的所有文件。
- **执行清理**：如果用户确认，删除 `/tmp` 目录下的所有文件和子目录。

### **步骤 4：清理 APT 缓存目录**

- **显示缓存占用**：显示 `/var/cache/apt/archives` 目录当前占用的空间。
- **用户确认**：提示用户是否清理 APT 缓存。
- **执行清理**：如果用户确认，使用 `apt clean` 命令清理缓存。

### **步骤 5：清理用户缓存目录 `~/.cache`**

- **显示缓存占用**：显示当前用户的缓存目录占用的空间。
- **用户确认**：提示用户是否清理用户缓存目录。
- **执行清理**：如果用户确认，删除 `~/.cache` 目录下的所有文件和子目录。

### **步骤 6：清理 systemd 日志 `/var/log/journal`**

- **显示日志占用**：显示 systemd 日志当前占用的空间。
- **用户确认**：提示用户是否清理 systemd 日志。
- **指定保留大小**：如果用户确认，提示输入要保留的日志大小（例如：100M，1G）。
- **执行清理**：使用 `journalctl --vacuum-size` 命令清理日志，保留指定大小的日志文件。

---

## 注意事项

- **备份重要数据**：在执行脚本前，建议备份重要数据，防止意外的数据丢失。
- **谨慎操作**：在每个步骤中，仔细阅读脚本的提示，根据实际需求选择是否执行清理。
- **权限要求**：脚本需要以 `root` 身份运行，以执行系统级的清理操作。
- **日志清理**：在清理 systemd 日志时，确保指定合理的保留大小，以免丢失重要的日志信息。
- **用户缓存**：清理 `~/.cache` 可能会导致某些应用程序在下次启动时变慢，因为需要重新生成缓存。
- **保持至少一个备用内核**：为了系统安全，建议至少保留一个备用内核，以防新内核出现问题时可以回滚。

---

## 示例输出

```plaintext
==============================
        Linux 系统清理脚本       
==============================

系统信息：
操作系统：Ubuntu 22.04.3 LTS
登录用户名：your_username
CPU 数量：8
内存大小：16G
已用内存：5.2G (32.50%)
硬盘总容量：512G
已用硬盘：100G (20%)
==============================

步骤 1：清理旧的内核包和残留的配置文件
当前正在运行的内核版本：6.1.0-18-amd64
已安装的内核包：
linux-image-6.1.0-18-amd64
linux-image-6.1.0-16-amd64
linux-image-6.1.0-15-amd64
将要移除的旧内核包：
linux-image-6.1.0-16-amd64
linux-image-6.1.0-15-amd64
是否确认移除以上内核包？[y/N]: y
正在移除旧内核包...
（移除过程中的输出）
自动清理不需要的依赖项...
（清理过程中的输出）
更新 GRUB 引导菜单...
Generating grub configuration file ...
（更新 GRUB 的输出）
旧内核包已成功移除。
正在清理残留的配置文件...
（清理残留配置文件的输出）
残留的配置文件已清理。

步骤 2：清理 /tmp 目录下的临时文件
是否清理 /tmp 目录下的所有文件？[y/N]: y
正在清理 /tmp 目录...
/tmp 目录已清理。

步骤 3：清理 APT 缓存目录 /var/cache/apt/archives
APT 缓存当前占用空间：500M
是否清理 APT 缓存？这将删除已下载的包文件。[y/N]: y
正在清理 APT 缓存...
APT 缓存已清理。

步骤 4：清理用户缓存目录 ~/.cache
用户缓存目录当前占用空间：1.2G
是否清理用户缓存目录 ~/.cache？[y/N]: y
正在清理用户缓存目录...
用户缓存目录已清理。

步骤 5：清理 systemd 日志 /var/log/journal
systemd 日志当前占用空间：1.5G
是否清理 systemd 日志？[y/N]: y
请输入要保留的日志大小（例如：100M，1G）：
保留大小： 500M
正在清理 systemd 日志，保留大小为 500M...
Vacuuming done, freed 1.0G of archived journals from /var/log/journal.
systemd 日志已清理。

系统清理完成！
==============================
```

---

## 脚本下载

您可以在 GitHub 仓库中找到该脚本的最新版本：[GitHub 链接](https://github.com/lcean/linuxclean)

---

## 贡献

欢迎提出问题、建议或提交拉取请求以改进此脚本。请访问 GitHub 仓库，参与项目的开发和讨论。

---

## 许可证

该项目采用 [MIT 许可证](https://opensource.org/licenses/MIT)。详细信息请参阅仓库中的 `LICENSE` 文件。

---

## 联系方式

如果您在使用过程中遇到任何问题，或有任何建议，请通过以下方式与我们联系：

- **电子邮件**：your_email@example.com
- **GitHub Issues**：在 [GitHub 仓库的 Issues 页面](https://github.com/lcean/linuxclean/issues) 提交问题。

---

## 致谢

感谢所有为本脚本的发展和改进做出贡献的用户和开发者！
